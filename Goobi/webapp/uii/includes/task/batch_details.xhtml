<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:composite="http://xmlns.jcp.org/jsf/composite" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:x="http://myfaces.apache.org/tomahawk">

    <composite:interface>
    </composite:interface>

    <composite:implementation>

        <!-- Box for process details -->
        <h:form id="detailsform">
            <div class="box thin-margin lightgrey box-bordered">
                <div class="box-title">
                    <h3>
                        <i class="fa fa-list"></i>
                        #{AktuelleSchritteForm.batchHelper.currentStep.prozess.titel}
                    </h3>
                    <div class="actions">
                        <h:commandLink id="expandBatch" styleClass="btn btn-mini font-light" action="#{NavigationForm.Reload}">
                            <i class="fa #{NavigationForm.uiStatus.task_viewWorkflow eq 'full'?'fa-compress':'fa-expand'}" />
                            <f:setPropertyActionListener target="#{NavigationForm.uiStatus.task_viewWorkflow}" value="#{NavigationForm.uiStatus.task_viewWorkflow eq 'full'?'part':'full'}" />
                            <f:ajax render=":detailsform" />
                        </h:commandLink>
                    </div>
                </div>

                <div class="box-content nopadding">

                    <!-- do not show the whole workflow -->
                    <h:panelGroup rendered="#{NavigationForm.uiStatus.task_viewWorkflow ne 'full'}">
                        <h:panelGrid columns="2" class="table table-bordered" style="border: 1px solid #ddd;">
                            <h:outputText value="#{msgs.arbeitsschritt}:" />
                            <h:outputText value="#{AktuelleSchritteForm.batchHelper.currentStep.titelLokalisiert}" />

                            <h:outputText value="#{msgs.prioritaet}:" />
                            <h:panelGroup>

                                <h:panelGroup rendered="#{AktuelleSchritteForm.batchHelper.currentStep.prioritaet == 0}">
                                    <span class="badge badge-intranda-light"> #{msgs.badgePriority0} </span>
                                </h:panelGroup>

                                <h:panelGroup rendered="#{AktuelleSchritteForm.batchHelper.currentStep.prioritaet == 1}">
                                    <span class="badge badge-intranda-orange">
                                        <i class="fa fa-lightbulb-o"></i>
                                        #{msgs.badgePriority1}
                                    </span>
                                </h:panelGroup>

                                <h:panelGroup rendered="#{AktuelleSchritteForm.batchHelper.currentStep.prioritaet == 2}">
                                    <span class="badge badge-intranda-orange">
                                        <i class="fa fa-lightbulb-o" />
                                        #{msgs.badgePriority2}
                                    </span>
                                </h:panelGroup>

                                <h:panelGroup rendered="#{AktuelleSchritteForm.batchHelper.currentStep.prioritaet gt 2 and AktuelleSchritteForm.batchHelper.currentStep.prioritaet lt 10}">
                                    <span class="badge badge-intranda-orange">
                                        <i class="fa fa-lightbulb-o"></i>
                                        #{msgs.badgePriority3}
                                    </span>
                                </h:panelGroup>

                                <h:panelGroup rendered="#{AktuelleSchritteForm.batchHelper.currentStep.prioritaet gt 9}">
                                    <span class="badge badge-intranda-red">
                                        <i class="fa fa-bullhorn"></i>
                                        #{msgs.badgeCorrection}
                                    </span>
                                </h:panelGroup>
                            </h:panelGroup>

                            <h:outputText value="#{msgs.status}:" />
                            <h:outputText value="#{AktuelleSchritteForm.batchHelper.currentStep.bearbeitungsstatusEnum.title}" />
                            <h:outputText value="#{msgs.bearbeiter}:" rendered="#{!HelperForm.anonymized}" />
                            <h:outputText value="#{AktuelleSchritteForm.batchHelper.currentStep.bearbeitungsbenutzer!=null and AktuelleSchritteForm.batchHelper.currentStep.bearbeitungsbenutzer.id!=0?(AktuelleSchritteForm.batchHelper.currentStep.bearbeitungsbenutzer.vorname).concat(' ').concat(AktuelleSchritteForm.batchHelper.currentStep.bearbeitungsbenutzer.nachname):''}" rendered="#{!HelperForm.anonymized}" />

                            <h:outputText value="#{msgs.bearbeitungsbeginn}:" rendered="#{AktuelleSchritteForm.batchHelper.currentStep.bearbeitungsbeginn !=null and !HelperForm.anonymized}" />
                            <h:outputText value="#{AktuelleSchritteForm.batchHelper.currentStep.bearbeitungsbeginnAsFormattedString}" rendered="#{AktuelleSchritteForm.batchHelper.currentStep.bearbeitungsbeginn !=null and !HelperForm.anonymized}" />

                            <h:outputText value="#{msgs.zuletztBearbeitet}:" rendered="#{AktuelleSchritteForm.batchHelper.currentStep.bearbeitungszeitpunkt !=null and !HelperForm.anonymized}" />
                            <h:outputText value="#{AktuelleSchritteForm.batchHelper.currentStep.bearbeitungszeitpunktAsFormattedString}" rendered="#{AktuelleSchritteForm.batchHelper.currentStep.bearbeitungszeitpunkt !=null and !HelperForm.anonymized}" />
                        </h:panelGrid>
                    </h:panelGroup>
                    <!-- / do not show the whole workflow -->


                    <!-- show the whole workflow -->
                    <h:panelGroup rendered="#{NavigationForm.uiStatus.task_viewWorkflow eq 'full'}">
                        <table class="table table-hover table-bordered">
                            <ui:repeat var="step" value="#{AktuelleSchritteForm.batchHelper.currentStep.prozess.schritteList}" id="stepList">
                                <tr>
                                    <td colspan="#{(step.bearbeitungsstatusEnum == 'DONE')?'1':'3'}">
                                        <ul class="colors small13">
                                            <li class="#{step.bearbeitungsstatusEnum.color} margin-top-lesser margin-right-regular" rel="tooltip" title="#{step.bearbeitungsstatusEnum.title}" />
                                        </ul>
                                        <h:outputText value="#{step.titelLokalisiert}" styleClass="#{step.bearbeitungsstatusEnum == 'INWORK'?'':'font-light'}" />

                                        <div class="row" style="padding-left: 160px; padding-right: 20px">
                                            <h:panelGrid columns="2" class="table table-bordered" style="border: 1px solid #ddd;" rendered="#{step.bearbeitungsstatusEnum == 'INWORK' and step.id eq AktuelleSchritteForm.batchHelper.currentStep.id}">
                                                <h:outputText value="#{msgs.prioritaet}:" />

                                                <h:panelGroup>

                                                    <h:panelGroup rendered="#{AktuelleSchritteForm.batchHelper.currentStep.prioritaet == 0}">
                                                        <span class="badge badge-intranda-light"> #{msgs.badgePriority0} </span>
                                                    </h:panelGroup>

                                                    <h:panelGroup rendered="#{AktuelleSchritteForm.batchHelper.currentStep.prioritaet == 1}">
                                                        <span class="badge badge-intranda-orange">
                                                            <i class="fa fa-lightbulb-o"></i>
                                                            #{msgs.badgePriority1}
                                                        </span>
                                                    </h:panelGroup>

                                                    <h:panelGroup rendered="#{AktuelleSchritteForm.batchHelper.currentStep.prioritaet == 2}">
                                                        <span class="badge badge-intranda-orange">
                                                            <i class="fa fa-lightbulb-o" />
                                                            #{msgs.badgePriority2}
                                                        </span>
                                                    </h:panelGroup>

                                                    <h:panelGroup rendered="#{AktuelleSchritteForm.batchHelper.currentStep.prioritaet gt 2 and AktuelleSchritteForm.batchHelper.currentStep.prioritaet lt 10}">
                                                        <span class="badge badge-intranda-orange">
                                                            <i class="fa fa-lightbulb-o"></i>
                                                            #{msgs.badgePriority3}
                                                        </span>
                                                    </h:panelGroup>

                                                    <h:panelGroup rendered="#{AktuelleSchritteForm.batchHelper.currentStep.prioritaet gt 9}">
                                                        <span class="badge badge-intranda-red">
                                                            <i class="fa fa-bullhorn"></i>
                                                            #{msgs.badgeCorrection}
                                                        </span>
                                                    </h:panelGroup>
                                                </h:panelGroup>

                                                <h:outputText value="#{msgs.status}:" />
                                                <h:outputText value="#{AktuelleSchritteForm.batchHelper.currentStep.bearbeitungsstatusEnum.title}" />
                                                <h:outputText value="#{msgs.bearbeiter}:" rendered="#{!HelperForm.anonymized}" />
                                                <h:outputText value="#{AktuelleSchritteForm.batchHelper.currentStep.bearbeitungsbenutzer!=null and AktuelleSchritteForm.batchHelper.currentStep.bearbeitungsbenutzer.id!=0?(AktuelleSchritteForm.batchHelper.currentStep.bearbeitungsbenutzer.vorname).concat(' ').concat(AktuelleSchritteForm.batchHelper.currentStep.bearbeitungsbenutzer.nachname):''}" rendered="#{!HelperForm.anonymized}" />

                                                <h:outputText value="#{msgs.bearbeitungsbeginn}:" rendered="#{AktuelleSchritteForm.batchHelper.currentStep.bearbeitungsbeginn !=null and !HelperForm.anonymized}" />
                                                <h:outputText value="#{AktuelleSchritteForm.batchHelper.currentStep.bearbeitungsbeginnAsFormattedString}" rendered="#{AktuelleSchritteForm.batchHelper.currentStep.bearbeitungsbeginn !=null and !HelperForm.anonymized}" />

                                                <h:outputText value="#{msgs.zuletztBearbeitet}:" rendered="#{AktuelleSchritteForm.batchHelper.currentStep.bearbeitungszeitpunkt !=null and !HelperForm.anonymized}" />
                                                <h:outputText value="#{AktuelleSchritteForm.batchHelper.currentStep.bearbeitungszeitpunktAsFormattedString}" rendered="#{AktuelleSchritteForm.batchHelper.currentStep.bearbeitungszeitpunkt !=null and !HelperForm.anonymized}" />



                                            </h:panelGrid>
                                        </div>


                                    </td>

                                    <h:panelGroup rendered="#{(step.bearbeitungsstatusEnum == 'DONE') and !HelperForm.anonymized}">
                                        <td>
                                            <h:outputText styleClass="font-light" value="#{step.bearbeitungsbenutzer!=null and step.bearbeitungsbenutzer.id!=0?(step.bearbeitungsbenutzer.vorname).concat(' ').concat(step.bearbeitungsbenutzer.nachname):''}" />
                                        </td>
                                        <td>
                                            <h:outputText styleClass="font-light" value="#{step.bearbeitungszeitpunkt !=null?step.bearbeitungszeitpunktAsFormattedString:''}" />
                                        </td>
                                    </h:panelGroup>
                                    <h:panelGroup rendered="#{(step.bearbeitungsstatusEnum == 'DONE') and HelperForm.anonymized}">
                                        <td colspan="2">
                                            <h:outputText styleClass="font-light" value="#{step.bearbeitungszeitpunkt !=null?step.bearbeitungszeitpunktAsFormattedString:''}" />
                                        </td>
                                    </h:panelGroup>

                                </tr>
                            </ui:repeat>
                        </table>
                    </h:panelGroup>
                    <!-- // show the whole workflow -->


                </div>
            </div>
        </h:form>

        <!-- Box for process log -->
        <h:form class="form-vertical form-bordered" id="processlog">
	        <div class="box thin-margin box-bordered">
	            <div class="box-title">
	                <x:aliasBeansScope>
                    	<f:subview id="sublog">
                       	<ui:include src="../processLog.xhtml" />
                       </f:subview>
                    </x:aliasBeansScope>
	            </div>
            
                <div class="box-content nopadding">
                    <div class="scrollable" data-start="bottom" data-visible="true" data-height="214" style="overflow: hidden; width: auto; height: 214px;">
                        <table style="width:100%" class="table table-hover table-bordered">
                               <ui:repeat var="entry" value="#{AktuelleSchritteForm.batchHelper.currentStep.prozess.processLog}" varStatus="row">
								<h:panelGroup rendered="#{!NavigationForm.uiStatus[entry.type.title]}">
									<tr>
										<td>
											<h:outputText value="#{entry.date}" styleClass="log_color_#{entry.type.title}" />
                                               <br />
                                               <h:outputText value="#{msgs[entry.userName]}" styleClass="log_color_#{entry.type.title}" />
										</td>
										<td>
											 <h:outputText value="#{entry.content}" styleClass="log_color_#{entry.type.title}" />
										</td>
										<h:panelGroup rendered="#{NavigationForm.showSecondLogField}">
											<td>
												<h:outputText value="#{entry.secondContent}" styleClass="log_color_#{entry.type.title}" />
											</td>
										</h:panelGroup>
										<h:panelGroup rendered="#{NavigationForm.showThirdLogField}">
											<td>
												<h:outputText value="#{entry.thirdContent}" styleClass="log_color_#{entry.type.title}" />
											</td>
										</h:panelGroup>
									</tr>  
								</h:panelGroup>                                  		
							</ui:repeat>
						</table>
                    </div>
                    <div class="form-actions" style="border-top: 1px solid #ddd;">
                        <div class="row">
                            <div class="col-sm-12">
                                <h:panelGroup styleClass="col-sm-4">
                                    <h:outputText value="#{msgs.process_log_firstContent}" />
                                </h:panelGroup>
                                <h:panelGroup styleClass="col-sm-8">
                                    <h:inputText id="addToTextArea" styleClass="form-control" value="#{AktuelleSchritteForm.batchHelper.content}" />
                                </h:panelGroup>


                                <h:panelGroup styleClass="col-sm-4 margin-top-10" rendered="#{NavigationForm.showSecondLogField}">
                                    <h:outputText value="#{msgs.process_log_secondContent}" />
                                </h:panelGroup>
                                <h:panelGroup styleClass="col-sm-8 margin-top-10" rendered="#{NavigationForm.showSecondLogField}">
                                    <h:inputText id="addToTextArea2" styleClass="form-control" value="#{AktuelleSchritteForm.batchHelper.secondContent}" />
                                </h:panelGroup>


                                <h:panelGroup styleClass="col-sm-4 margin-top-10" rendered="#{NavigationForm.showThirdLogField}">
                                    <h:outputText value="#{msgs.process_log_thirdContent}" />
                                </h:panelGroup>
                                <h:panelGroup styleClass="col-sm-8 margin-top-10" rendered="#{NavigationForm.showThirdLogField}">
                                    <h:inputText id="addToTextArea3" styleClass="form-control" value="#{AktuelleSchritteForm.batchHelper.thirdContent}" />
                                </h:panelGroup>
                            </div>
                        </div>
                    </div>


                    <div class="form-actions">
                        <div class="row">
                            <div class="col-sm-12">
                                <h:commandButton id="addToAll" type="submit" styleClass="btn btn-primary margin-left-5 margin-top-regular font-size-s pull-right" value="#{msgs.nachrichtHinzufuegenForAll}" action="#{AktuelleSchritteForm.batchHelper.addLogEntryForAll}" />
                                <h:commandButton id="addToCurrent" type="submit" styleClass="btn btn-primary margin-top-regular font-size-s pull-right" value="#{msgs.nachrichtHinzufuegen}" action="#{AktuelleSchritteForm.batchHelper.addLogEntry}" />
                            </div>
                        </div>
                  
                    </div>
                </div>
	        </div>
        </h:form>
        <!-- // Box for process log -->

    </composite:implementation>

</ui:composition>


