<!DOCTYPE html>
<html lang="#{SpracheForm.locale}" xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:c="http://java.sun.com/jstl/core"
    
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:o="http://omnifaces.org/ui"
    xmlns:jsf="http://xmlns.jcp.org/jsf"
    xmlns:ds="http://deltaspike.apache.org/jsf">

    <!-- BOOTSTRAP 5 TODO -->

<h:head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Apple devices fullscreen -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <!-- Apple devices fullscreen -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="description" content="Goobi workflow" />
    <meta name="author" content="intranda GmbH" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Script-Type" content="type" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta name="date" content="1970-01-01T00:00:00+01:00" />
    <meta name="application" content="#{HelperForm.applicationHeaderTitle}" />
    <meta name="version" content="#{HelperForm.version}" />
    <meta name="build date" content="#{HelperForm.buildDate}" />
    <meta name="git-revision" content="#{HelperForm.revision}" />
    <title><h:outputText value="#{HelperForm.applicationHeaderTitle}" /></title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="template/css/bootstrap.min.css?v=#{HelperForm.buildVersion}" />
    <link rel="stylesheet" href="template/css/bootstrap-slider.css?v=#{HelperForm.buildVersion}" />
    <!-- Theme CSS -->
    <link rel="stylesheet" href="template/css/style.css?v=#{HelperForm.buildVersion}" />
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="template/css/font-awesome.css?v=#{HelperForm.buildVersion}" />
    <!-- Color CSS -->
    <link rel="stylesheet" href="template/css/themes.css?v=#{HelperForm.buildVersion}" />
    <!-- intranda -->
    <link rel="stylesheet" href="template/css/intranda.css?v=#{HelperForm.buildVersion}" />
    <!-- <link rel="stylesheet" href="template/css/dist/goobiWorkflow.min.css?v=#{HelperForm.buildVersion}" /> -->

    <script src="template/js/intranda.js?v=1.2"></script>
    <!-- jQuery -->
    <h:outputScript library="primefaces" name="jquery/jquery.js?v=#{HelperForm.buildVersion}" target="head" />
    <!-- Mobile nav swipe -->
    <script src="template/js/plugins/touchwipe/touchwipe.min.js?v=#{HelperForm.buildVersion}"></script>
    <!-- Nice Scroll -->
    <script src="template/js/plugins/nicescroll/jquery.nicescroll.min.js?v=#{HelperForm.buildVersion}"></script>
    <!-- imagesLoaded -->
    <script src="template/js/plugins/imagesLoaded/jquery.imagesloaded.min.js?v=#{HelperForm.buildVersion}"></script>
    <!-- jQuery UI -->
    <script src="template/js/plugins/jquery-ui/jquery-ui.js?v=#{HelperForm.buildVersion}"></script>
    <!-- slimScroll -->
    <script src="template/js/plugins/slimscroll/jquery.slimscroll.min.js?v=#{HelperForm.buildVersion}"></script>
    <!-- Bootstrap -->
    <script src="template/js/bootstrap.min.js?v=#{HelperForm.buildVersion}"></script>
    <script src="template/js/bootstrap-slider.js?v=#{HelperForm.buildVersion}"></script>
    <!-- Bootbox -->
    <script src="template/js/plugins/bootbox/jquery.bootbox.js?v=#{HelperForm.buildVersion}"></script>
    <!-- Bootbox -->
    <script src="template/js/plugins/form/jquery.form.min.js?v=#{HelperForm.buildVersion}"></script>
    <!-- Reactive rx -->
     <script src="template/js/reactiveX/rx.lite.min.js"></script>
    <!-- Validation -->
    <script src="template/js/plugins/validation/jquery.validate.min.js?v=#{HelperForm.buildVersion}"></script>
    <script src="template/js/plugins/validation/additional-methods.min.js?v=#{HelperForm.buildVersion}"></script>
	<!-- shortcuts -->
	<script src="template/js/jquery.hotkeys.js?v=#{HelperForm.buildVersion}"></script>
    <!-- Theme framework -->
    <!-- <script src="template/js/eakroko.js?v=#{HelperForm.buildVersion}"></script> -->
    <!-- Theme scripts -->
    <script src="template/js/application.js?v=#{HelperForm.buildVersion}"></script>

    <!--[if lte IE 9]>
	<script src="template/js/plugins/placeholder/jquery.placeholder.min.js?v=#{HelperForm.buildVersion}"></script>
		<script>
			$(document).ready(function() {
				$('input, textarea').placeholder();
			});
		</script>
	<![endif]-->
    <!-- Favicon -->
    <link rel="shortcut icon" href="template/img/favicon.ico" />
    <!-- Apple devices Homescreen icon -->
    <link rel="apple-touch-icon-precomposed" href="template/img/apple-touch-icon.png" />

	<!-- WCAG compatibility CSS -->

	<ui:fragment rendered="#{LoginForm.myBenutzer == null ? HelperForm.renderAccessibilityCss : LoginForm.myBenutzer.uiMode=='accessibility'}">
		<link rel="stylesheet" href="template/css/accessibility.css?v=#{HelperForm.buildVersion}" />
	</ui:fragment>

    <!-- CUSTOM CSS -->
    <style>
        <h:outputText value="#{LoginForm.myBenutzer.customCss}" escape="false" />
    </style>
    <span class="outer-skip-link">
    	<a class="skip-main sr-only" href="#main-content" tabindex="0">#{msgs.skipMainContent}</a>
    </span>
</h:head>

<ui:insert name="metadata" />

<h:body styleClass="#{LoginForm.myBenutzer == null?'login':'sidebar-right'}" style="#{LoginForm.myBenutzer == null?'height:300px;':''}">
   <ds:windowId/>
    <f:view locale="#{SpracheForm.locale}">

        <h:panelGroup rendered="#{LoginForm.myBenutzer==null}">
            <ui:include src="inc_login.xhtml" />
        </h:panelGroup>

        <c:if test="#{LoginForm.myBenutzer!=null}">
            <ui:include src="inc_menu.xhtml" />

            <div class="container-fluid" id="content" style="padding-bottom:20px">
                <!-- 				<div id="left"> -->
                <!-- 					<ui:insert name="sidebar"> -->
                <!-- 						<ui:include src="inc_sidebar.xhtml" /> -->
                <!-- 					</ui:insert> -->
                <!-- 				</div> -->
                <div id="main" style="margin-right: 0px;">
                    <div class="container-fluid">

                        <h:form id="header">
                            <o:socket channel="developerMessageChannel" connected="#{DevModeBean.developerMode}" onmessage="() => window.location.reload()" />
                            <header>
                                <div class="page-header">
                                    <h:panelGroup id="globalWarningMessage">
                                        <h:panelGroup rendered="#{SessionForm.logoutMessage != ''}" styleClass="alert alert-danger block" style="line-height:40px;font-size:24px;">
                                            <span class="fa fa-exclamation-triangle margin-right-10" />
                                            <h:outputText value="#{SessionForm.logoutMessage}" />
                                        </h:panelGroup>
                                    </h:panelGroup>
                                    <o:socket channel="adminMessageChannel">
                                        <f:ajax event="update" render="globalWarningMessage"/>
                                    </o:socket>
	                                <div class="pull-left">
	                                    <h1>
	                                        <ui:insert name="title">
	                                            <h:outputText value="#{myPageTitle}" />
	                                        </ui:insert>
	                                    </h1>
	                                </div>
	                                <div class="pull-right">
	                                    <ui:insert name="info" />
	                                    <ul class="stats">

	                                        <li id="ajaxloader" class='' style="display: none;margin-top: -20px;">
	                                            <img src="template/img/goobi/ajaxloader2.gif" />
	                                        </li>

											<ui:fragment rendered="#{LoginForm.hasAnyGoobiScriptRole and SessionForm.gsm.goobiScriptResultSize gt 0}">
                                                <o:socket channel="goobiscriptUpdateChannel" >
                                                    <f:ajax render="goobiScriptResults2" event="update"/>
                                                </o:socket>
                                                <o:commandScript name="updateGoobiScriptIndicator" render="goobiScriptResults2" />
	                                        	<li class="#{SessionForm.gsm.hasErrors?'background-color-F':'background-color-D'}">
		                                            <button jsf:action="process_goobiScript" jsf:id="goobiScriptResults2" class="button-transparent">
		                                                    <span class="fa fa-cog #{SessionForm.gsm.goobiScriptHasResults('WAITING') or SessionForm.gsm.goobiScriptHasResults('RUNNING')?'fa-spin':''}" />
		                                                    <div class="details">
		                                                        <span class="big">#{msgs.goobiScript_isActive}</span>
		                                                        <span>#{SessionForm.gsm.numberOfFinishedScripts} / #{SessionForm.gsm.goobiScriptResultSize}</span>
		                                                    </div>
		                                                </button>
		                                        </li>
	                                        </ui:fragment>


	                                        <h:panelGroup rendered="#{!HelperForm.anonymized and LoginForm.hasRole('Statistics_CurrentUsers')}">
	                                            <li class='background-color-A'>
	                                                <button jsf:action="currentUsers" jsf:id="currentUsers" class="button-no-style">
	                                                    <i class="fa fa-users" style="margin-top:3px;"></i>
	                                                    <div class="details">
	                                                        <span>#{msgs.aktiveBenutzer}</span>
	                                                        <span class="big pull-left">#{SessionForm.numberOfSessions}</span>
	                                                        <f:setPropertyActionListener target="#{NavigationForm.aktuell}" value="" />
	                                                    </div>
	                                                </button>
	                                            </li>
	                                        </h:panelGroup>
	                                        <li class='background-color-A'>
	                                            <i class="fa fa-calendar" style="margin-top:3px;"></i>
	                                            <div class="details">
	                                                <span class="big">
	                                                    <h:outputText value="#{SessionForm.currentTime}" />
	                                                    <a tabindex="-1" href="#{HelperForm.itmPathAsUrl}" target="self" aria-label="itm">
														<div style="height: 12px;width: 20px;display: inline-block;"></div>
														</a>
	                                                </span>
	                                                <span>
	                                                    <h:outputText value="#{SessionForm.date}">
	                                                    	<f:convertDateTime locale="#{SpracheForm.locale}" type="both" dateStyle="medium"/>
		                                                </h:outputText>
	                                                </span>
	                                            </div>
	                                        </li>

	                                    </ul>
	                                </div>
	                            </div>
                            </header>
                        </h:form>
                        <nav aria-label="navigationBreadcrumb">
	                        <h:form style="margin:0px;" id="breadcrumb">

	                            <div class="breadcrumbs">
	                                <ul>
	                                    <ui:insert name="breadcrumb" />
	                                </ul>

	                                <!--                                 <div class="close-bread" style="float: right;"> -->
	                                <!--                                     <a href="#"> -->
	                                <!--                                         <span class="fa fa-remove" /> -->
	                                <!--                                     </a> -->
	                                <!--                                 </div> -->
	                            </div>
	                        </h:form>
						</nav>
						<div role="complementary">
							<h:panelGroup id="globalMessage" style="display: inline">
                        		<h:messages escape="false" globalOnly="true" errorClass="alert alert-danger" infoClass="alert alert-info" warnClass="alert" showDetail="true" showSummary="true" tooltip="true" styleClass="messages" />
			             	</h:panelGroup>
			            </div>
                        <div jsf:id="main-content" tabindex="-1">
                            <ui:insert name="content" />
                        </div>
                    </div>
                </div>
            </div>
        </c:if>

        <!-- JAVASCRIPT -->
        <script src="template/js/dist/goobiWorkflowJS.min.js?v=#{HelperForm.buildVersion}"></script>
        <script>
            // goobiWorkflowConfig = {};

            // goobiWorkflowJS.init(goobiWorkflowConfig);
        </script>
        <script>
     // <![CDATA[
            faces.ajax.addOnEvent(function (data) {
                var ajaxstatus = data.status; // Can be "begin", "complete" and "success"
                var ajaxloader = document.getElementById("ajaxloader");
                var source = data.source;
                var noLoaderGif = source.type == "hidden" && source.id.indexOf("header") == 0;

                switch (ajaxstatus) {
                    case "begin": // This is called right before ajax request is been sent.
                    	if(ajaxloader && !noLoaderGif) {
                        	ajaxloader.style.display = 'block';
                    	}
                        break;

                    case "complete": // This is called right after ajax response is received.
                    	if(ajaxloader) {
                        	ajaxloader.style.display = 'none';
                    	}
                        break;

                    case "success": // This is called when ajax response is successfully processed.
                        // NOOP.
                        $(function () {
                            $('[data-toggle="tooltip"]').tooltip();
                            $('[data-toggle="popover"]').popover();
                            if ($('.popover.fade.right.in').length > 0) {
                                $('.popover.fade.right.in').remove();
                            }
                            scrollDownScrollDowns();
                        })
                        if (window.noLoadImages === undefined) {
                            loadImages();
                        }
                        break;
                }
            });

            $(document).ready(function () {
                $('[data-toggle="tooltip"]').tooltip();
                $('[data-toggle="popover"]').popover();
                if ($('.popover.fade.right.in').length > 0) {
                    $('.popover.fade.right.in').remove();
                }
                setTimeout(scrollDownScrollDowns(), 100);
                if(typeof updateGoobiScriptIndicator !== 'undefined') {
                	setTimeout(updateGoobiScriptIndicator, 500);
                }
            });

        	function toggle_help(data) {
        		if (data.status === 'success') {
        			elements = document.getElementsByClassName("help-block");
            	    for (var i = 0; i < elements.length; i++) {
            	        elements[i].style.display = elements[i].style.display == 'block' ? 'none' : 'block';
            	    }
        	    }
        	}

            $(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+right', function () {
                var myButton = $("a[id$=':navnext']")
                if (myButton != null) {
                    myButton.click();
                }
            });

            $(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+left', function () {
                var myButton = $("a[id$=':navprev']")
                if (myButton != null) {
                    myButton.click();
                }
            });

            window.myfaces = window.myfaces || {};
            myfaces.config = myfaces.config || {};
            //set the config part
            myfaces.config.no_portlet_env = true;

         // ]]>
        </script>
    </f:view>
</h:body>
</html>
