<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:of="http://omnifaces.org/functions"
    
    xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    template="/uii/template/template_metseditor.html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:jsf="http://xmlns.jcp.org/jsf">

    <ui:param
        name="myPageTitle"
        value="#{Metadaten.myProzess.titel}" />

    <ui:define name="sidebar">
        <ui:include src="includes/metseditor/metseditor_structure.xhtml" />
    </ui:define>

    <ui:define name="menu">
        <ui:include src="includes/metseditor/metseditor_menu.xhtml" />
    </ui:define>

    <ui:define name="menu_mobile">
        <ui:include src="includes/metseditor/metseditor_menu_mobile.xhtml" />
    </ui:define>

    <ui:define name="content">
    <main>
        <h:form
            id="progressform"
            prependId="false">
            <!-- Modal -->
            <div
                class="modal fade"
                id="unsavedChanges"
                tabindex="-1"
                role="dialog"
                aria-labelledby="myModalLabel">
                <div
                    class="modal-dialog"
                    role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <a
                                href="#"
                                class="btn btn-blue pull-right"
                                title="#{msgs.cancel}"
                                data-dismiss="modal">
                                <span class="fa fa-times" />
                            </a>

                            <h4
                                class="modal-title"
                                id="myModalLabel">
                                <h:outputText value="#{msgs.metseditorFinish}" />
                            </h4>
                        </div>
                        <div class="modal-body">
                            <h:outputText value="#{msgs.metseditorSaveExplanation}" />
                        </div>
                        <div class="modal-footer">

                            <button
                                jsf:id="discard"
                                class="btn btn-lightred pull-left"
                                jsf:action="#{Metadaten.discard}"
                                title="#{msgs.discard}">
                                <span class="fa fa-trash-o margin-right-5" />
                                <h:outputText value="#{msgs.discard}" />
                            </button>

                            <button
                                jsf:id="overwrite"
                                class="btn btn-green"
                                jsf:action="#{Metadaten.XMLschreiben}"
                                onclick="goobiWorkflowJS.progress.displayProgressBar()"
                                title="#{msgs.overwrite}">
                                <span class="fa fa-floppy-o margin-right-5" />
                                <h:outputText value="#{msgs.overwrite}" />
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <h:panelGroup
                style="display: none"
                id="progressPanel">
                <p:commandButton
                    value="Start"
                    onclick="PF('pbAjax').start();"
                    type="button"
                    widgetVar="startButton2"
                    id="progressbutton"
                    style="display: none;" />

                <p:progressBar
                    widgetVar="pbAjax"
                    ajax="true"
                    value="#{Metadaten.progress}"
                    labelTemplate="{value}%"
                    styleClass="animated"
                    global="false">
                    <p:ajax
                        event="complete"
                        listener="#{Metadaten.onComplete}" />
                </p:progressBar>
            </h:panelGroup>

            <script type="text/javascript">
				function displayProgressBar() {
                    var element = document.getElementById('progressPanel');
                    if (element.style.display == 'block') {
                        element.style.display = 'none';
                    } else {
                        element.style.display = 'block';
                    }
                    document.getElementById('progressbutton').click();
                }

                function start() {
                    window['progress'] = setInterval( function () {
                        var pbClient = PF('pbClient'), oldValue = pbClient.getValue(), newValue = oldValue + 10;

                        pbClient.setValue(pbClient.getValue() + 10);

                        if (newValue === 100) {
                            clearInterval(window['progress']);
                        }
                    }, 1000);
                }
             </script>
        </h:form>

        <div class="row">
            <div
                id="contentArea"
                class="col-xs-12 col-sm-6">
                <h:panelGroup
                    rendered="#{SessionForm.logoutMessage!=''}"
                    styleClass="alert alert-danger block margin-top-regular"
                    style="line-height:40px;font-size:24px;">
                    <span class="fa fa-exclamation-triangle margin-right-10 " />
                    <h:outputText value="#{SessionForm.logoutMessage}" />
                </h:panelGroup>

                <h:messages
                    id="messages"
                    escape="false"
                    globalOnly="true"
                    errorClass="alert alert-danger alert-dismissable"
                    infoClass="alert alert-info "
                    warnClass="alert"
                    showDetail="true"
                    showSummary="true"
                    tooltip="true"
                    styleClass="messages " />

                <h:panelGroup rendered="#{Metadaten.modusAnsicht =='Paginierung'}">
                    <ui:include src="includes/metseditor/metseditor_pagination.xhtml" />
                </h:panelGroup>
                <h:panelGroup rendered="#{Metadaten.modusAnsicht == 'Metadaten'}">
                    <ui:include src="includes/metseditor/metseditor_metadata.xhtml" />
                </h:panelGroup>
                <h:panelGroup rendered="#{Metadaten.modusAnsicht =='Strukturdaten'}">
                    <ui:include src="includes/metseditor/metseditor_structdata.xhtml" />
                </h:panelGroup>
                <h:panelGroup rendered="#{Metadaten.modusAnsicht =='File'}">
                    <ui:include src="includes/metseditor/metseditor_file.xhtml" />
                </h:panelGroup>
            </div>

            <div
                id="metseditorImage"
                class="col-xs-12 col-sm-6">
                <ui:include src="includes/metseditor/metseditor_image.xhtml" />
            </div>
        </div>


        <script type="text/javascript">
        	function fitResizeHandle() {
            	var resizeHandle = $( '#left .ui-resizable-handle' );
            	var treeformHeight = $( '#treeform' ).outerHeight();
				resizeHandle.css( 'height', treeformHeight );

        	}

			function isIE() {
				var agent = navigator.userAgent.toLowerCase();
				var name = 'MSIE';
				if (agent.indexOf(name.toLowerCase()) > -1) {
					return true;
				}

				return false;
			}

            function styleAnpassen2(element) {
		 		var galleryLinks;
				galleryLinks = document.getElementsByClassName('documentSelected');
				for (var i = 0; i &lt; galleryLinks.length; i++)
					galleryLinks[i].className = "document";
				element.className = "documentSelected";
				return true;
			}

            $(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+right', function() {
            	var myButton = document.getElementById("imageNext");
            	if (myButton!=null) {
            		myButton.click();
            	}
            });

            $(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+left', function() {
            	var myButton = document.getElementById("imageBack");
            	if (myButton!=null) {
            		myButton.click();
            	}
            });

            $(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+up', function() {
            	var myButton = document.getElementById("imageNext20");
            	if (myButton!=null) {
            		myButton.click();
            	}
            });

            $(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+down', function() {
            	var myButton = document.getElementById("imageBack20");
            	if (myButton!=null) {
            		myButton.click();
            	}
            });

            $(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+home', function() {
            	var myButton = document.getElementById("imageFirst");
            	if (myButton!=null) {
            		myButton.click();
            	}
            });

            $(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+end', function() {
            	var myButton = document.getElementById("imageLast");
            	if (myButton!=null) {
            		myButton.click();
            	}
            });

            $(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+return', function() {
            	var myButton = document.getElementById("menu-form:saveMetsFileButtonAjax");
            	if (myButton!=null) {
            		myButton.click();
            	}
            });

            $(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+v', function() {
            	var myButton = document.getElementById("menu-form:startValidationButton");
            	if (myButton!=null) {
            		myButton.click();
            	}
            });

            $(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+space', function() {
				var hiddenImageNo =$("#hiddenImageNo").val();
				if (hiddenImageNo == null){
					hiddenImageNo =$("#hiddenImageNoThumb").val();
				}
				for (i = 0; i &lt; document.getElementsByName("myCheckboxes").length; i++) {
					if (i == hiddenImageNo ) {
					    var checkbox = document.getElementsByName("myCheckboxes")[i];
					    if (checkbox.checked) {
					        checkbox.checked = false;
					    } else {
					        checkbox.checked = true;
					    }
					    checkbox.focus();
					    checkbox.blur();
					}
				}
			});

            $('input:checkbox').bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+right', function() {
            	var myButton = document.getElementById("imageNext");
            	if (myButton!=null) {
            		myButton.click();
            	}
            });

            $('input:checkbox').bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+left', function() {
            	var myButton = document.getElementById("imageBack");
            	if (myButton!=null) {
            		myButton.click();
            	}
            });

            $('input:checkbox').bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+up', function() {
            	var myButton = document.getElementById("imageNext20");
            	if (myButton!=null) {
            		myButton.click();
            	}
            });

            $('input:checkbox').bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+down', function() {
            	var myButton = document.getElementById("imageBack20");
            	if (myButton!=null) {
            		myButton.click();
            	}
            });

            $('input:checkbox').bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+home', function() {
            	var myButton = document.getElementById("imageFirst");
            	if (myButton!=null) {
            		myButton.click();
            	}
            });

            $('input:checkbox').bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+end', function() {
            	var myButton = document.getElementById("imageLast");
            	if (myButton!=null) {
            		myButton.click();
            	}
            });

            $('input:checkbox').bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+return', function() {

            	var myButton = document.getElementById("menu-form:saveMetsFileButtonAjax");
            	console.log(myButton);
            	if (myButton!=null) {
            		myButton.click();
            	}
            });

            $('input:checkbox').bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+v', function() {

            	var myButton = document.getElementById("menu-form:startValidationButton");
            	console.log(myButton);
            	if (myButton!=null) {
            		myButton.click();
            	}
            });

            $('input:checkbox').bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+space', function() {
				var hiddenImageNo =$("#hiddenImageNo").val();
				for (i = 0; i &lt; document.getElementsByName("myCheckboxes").length; i++) {
					if (i == hiddenImageNo ) {
					    var checkbox = document.getElementsByName("myCheckboxes")[i];
					    if (checkbox.checked) {
					        checkbox.checked = false;
					    } else {
					        checkbox.checked = true;
					    }
					}
				}
			});

            var readOnlyMode = '#{Metadaten.nurLesenModus}';
            var autoSave = function() {
                var interval = parseInt('#{LoginForm.myBenutzer.metsEditorTime}');
//             	 TODO check if mets editor was opened read only
            	if (interval > 0) {
                	setInterval( function() {
                 		var myButton = document.getElementById("menu-form:automaticSave");
                     	if (myButton!=null) {
                     		myButton.click();
                     	}
                	}, interval*1000*60);
            	}
            };

            if (readOnlyMode === 'false') {
                autoSave();
            }

            $(document).ready( function () {
                fitResizeHandle();
            });
         </script>

        <h:form
            id="normdataForm"
            prependId="false">
            <h:inputHidden
                id="rowType"
                value="#{Metadaten.rowType}" />
            <h:inputHidden
                id="rowIndex"
                value="#{Metadaten.rowIndex}" />
            <h:inputHidden
                id="groupIndex"
                value="#{Metadaten.groupIndex}" />
            <button
                jsf:id="updatePluginButton"
                style="display:none;"
                jsf:action="#{Metadaten.loadCurrentPlugin}">
                <f:ajax
                    execute="rowType rowIndex groupIndex"
                    render="processModalContent" />
            </button>
            <!-- Modal -->
            <div
                class="modal fade"
                id="gndSearchBox"
                tabindex="-1"
                role="dialog"
                aria-labelledby="myModalLabel">
                <div
                    class="modal-dialog"
                    role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <a
                                href="#"
                                class="btn btn-blue pull-right"
                                title="#{msgs.cancel}"
                                data-dismiss="modal">
                                <span class="fa fa-times" />
                            </a>

                            <h4
                                class="modal-title"
                                id="myModalLabel">
                                <h:outputText value="#{msgs.NORM_gndSearch}" />
                            </h4>
                        </div>
                        <div class="modal-body">

                            <h:outputText
                                value="#{msgs.NORM_helpGndSearch}"
                                escape="false" />

                            <br />

                            <div
                                class="row"
                                style="margin-top: 15px;">
                                <div class="col-sm-4 control-label">
                                    <h:selectOneMenu
                                        value="#{Metadaten.searchOption}"
                                        styleClass="form-control">
                                        <f:selectItem
                                            itemLabel="#{msgs.NORM_identifier}"
                                            itemValue="" />
                                        <f:selectItem
                                            itemLabel="#{msgs.NORM_person}"
                                            itemValue="Tp*" />
                                        <f:selectItem
                                            itemLabel="#{msgs.NORM_organisation}"
                                            itemValue="Tb*" />
                                        <f:selectItem
                                            itemLabel="#{msgs.NORM_keyword}"
                                            itemValue="Ts*" />
                                        <f:selectItem
                                            itemLabel="#{msgs.NORM_geografika}"
                                            itemValue="Tg*" />
                                    </h:selectOneMenu>
                                </div>

                                <div class="col-sm-8">
                                    <!-- search button? -->
                                    <h:inputText
                                        value="#{Metadaten.gndSearchValue}"
                                        styleClass="form-control input"
                                        id="input" />
                                </div>

                                <button
                                	jsf:id="metadataSearch"
                                    class="btn btn-grey pull-right margin-right-10 margin-top-10 margin-bottom-10"
                                    jsf:action="#{Metadaten.search}"
                                    title="#{msgs.search}">
                                    <span class="fa fa-search margin-right-5" />
                                    <h:outputText value="#{msgs.search}" />
                                    <f:ajax
                                        execute="@form"
                                        render="list" />
                                </button>

                                <script>
                                $('input[id*="input"]' ).on('focus',function() {
                                    $(this ).on('keyup',function(event ) {
                                        event.preventDefault();
                                        if ( event.keyCode == 13 ) {
                                            $(this ).parent().next().click();
                                        }
                                    } );
                                } );
                                </script>
                            </div>


                            <h:panelGroup
                                layout="block"
                                id="list"
                                class="row pre-scrollable">
                                <ui:repeat
                                    value="#{Metadaten.currentMetadataToPerformSearch.dataList}"
                                    var="normdataList">
                                    <hr />
                                    <div
                                        class="row"
                                        style="margin: 20px;">


                                        <div class="col-sm-11">

                                            <ui:repeat
                                                value="#{normdataList}"
                                                var="normdata">
                                                <div class="row">
                                                    <div class="col-sm-4">
                                                        <h:outputText value="#{msgs[normdata.key]}" />
                                                    </div>

                                                    <div class="col-sm-8">
                                                        <ui:repeat
                                                            value="#{normdata.values}"
                                                            var="value">
                                                            <div class="row">
                                                                <div class="col-sm-12">
                                                                    <h:outputLink
                                                                        rendered="#{value.url != null}"
                                                                        target="_blank"
                                                                        value="#{value.url}">
                                                                        <h:outputText value="#{value.text}" />
                                                                        <h:outputText
                                                                            rendered="#{value.identifier != null}"
                                                                            value=" (#{value.identifier})" />
                                                                    </h:outputLink>

                                                                    <h:outputText
                                                                        value="#{value.text}"
                                                                        rendered="#{value.url == null}" />
                                                                </div>
                                                            </div>
                                                        </ui:repeat>
                                                    </div>
                                                </div>
                                            </ui:repeat>
                                        </div>
                                        <h:panelGroup
                                            layout="block"
                                            class="col-sm-1">
                                            <button
                                            	jsf:id="getData"
                                                class="btn btn-green margin-left-5"
                                                jsf:action="#{Metadaten.currentMetadataToPerformSearch.getData}">
                                                <f:setPropertyActionListener
                                                    value="#{normdataList}"
                                                    target="#{Metadaten.currentMetadataToPerformSearch.currentData}" />
                                                <f:setPropertyActionListener
                                                    value=""
                                                    target="#{Metadaten.searchOption}" />
                                                <f:setPropertyActionListener
                                                    value=""
                                                    target="#{Metadaten.gndSearchValue}" />
                                                <f:setPropertyActionListener
                                                    value=""
                                                    target="#{Metadaten.rowIndex}" />
                                                <span class="fa fa-check" />
                                            </button>
                                        </h:panelGroup>
                                    </div>
                                </ui:repeat>
                                <h:outputText
                                    value="#{msgs.NORM_noHits}"
                                    rendered="#{Metadaten.currentMetadataToPerformSearch != NULL and Metadaten.currentMetadataToPerformSearch.showNoHitFound}"
                                    style="margin: 20px;" />

                            </h:panelGroup>
                        </div>
                    </div>
                </div>
            </div>

            <!-- process search modal #processesSearchBox -->
            <style>
.searchgroup-container {
    border: 1px solid #ddd;
    margin-bottom: 5px;
    padding: 25px 10px 10px 10px;
}

.new-filter-btn {
    display: block;
    text-align: right;
    margin-top: 7px;
}

.filter-row {
    float: left;
    margin-top: 3px;
    width: calc(100% - 42px);
}

.controls-row {
    margin-top: 12px;
}

.group-conjunction td {
    padding: 3px;
}

.group-conjunction input[type="radio"] {
    margin: -3px 5px 0 0;
    vertical-align: middle;
}

.group-conjunction table {
    margin-top: 5px;
}

.modal-xxl {
    width: 90vw;
}

.shrink {
    float: left;
    width: 16px;
    margin-top: 9px;
}
</style>
            <div
                class="modal fade"
                id="processesSearchBox"
                tabindex="-1"
                role="dialog"
                aria-labelledby="myModalLabel">
                <div
                    class="modal-dialog modal-xxl"
                    role="document">
                    <h:panelGroup
                        layout="block"
                        styleClass="modal-content"
                        id="processModalContent">
                        <div class="modal-header">
                            <a
                                href="#"
                                class="btn btn-blue pull-right"
                                title="#{msgs.cancel}"
                                data-dismiss="modal">
                                <span class="fa fa-times" />
                            </a>

                            <h4
                                class="modal-title"
                                id="myModalLabel">
                                <h:outputText value="#{msgs.NORM_processesSearch}" />
                            </h4>
                        </div>
                        <div class="modal-body">

                            <h:outputText
                                value="#{msgs.NORM_helpProcessesSearch}"
                                escape="false" />

                            <br />



                            <h:panelGroup
                                layout="block"
                                id="processes_search"
                                styleClass="row"
                                style="margin-top: 15px;">
                                <div class="col-sm-12">
                                    <c:if test="#{Metadaten.currentMetadataToPerformSearch.title == 'ProcessPlugin'}">
                                        <ui:repeat
                                            value="#{Metadaten.currentMetadataToPerformSearch.searchRequest.metadataFilters}"
                                            var="group"
                                            varStatus="globStatus">
                                            <div class="row">
                                                <div class="col-sm-12">
                                                    <div class="searchgroup-container clearfloat">
                                                        <button
                                                        	jsf:id="searchRequest"
                                                            jsf:action="#{Metadaten.currentMetadataToPerformSearch.searchRequest.deleteSearchGroup(globStatus.index)}"
                                                            class="button-no-style fa fa-times"
                                                            style="position:absolute; top:5px; right:21px;">
                                                            <f:ajax
                                                                execute=":normdataForm:processes_search"
                                                                render=":normdataForm:processes_search" />
                                                        </button>
                                                        <ui:repeat
                                                            var="filter"
                                                            value="#{group.filters}"
                                                            varStatus="status">
                                                            <div class="row">
                                                                <div class="filter-row">
                                                                    <div class="col-sm-2 control-label">
                                                                        <h:selectOneMenu
                                                                            value="#{filter.field}"
                                                                            styleClass="form-control">
                                                                            <f:selectItems value="#{Metadaten.currentMetadataToPerformSearch.possibleFields}" />
                                                                        </h:selectOneMenu>
                                                                    </div>
                                                                    <div class="col-sm-1 control-label">
                                                                        <h:selectOneMenu
                                                                            value="#{filter.relation}"
                                                                            styleClass="form-control">
                                                                            <f:selectItems value="#{filter.operators}" />
                                                                        </h:selectOneMenu>
                                                                    </div>
                                                                    <div class="col-sm-9">
                                                                        <!-- 								                                    search button? -->
                                                                        <h:inputText
                                                                            value="#{filter.value}"
                                                                            styleClass="form-control input"
                                                                            id="input_processes" />
                                                                    </div>
                                                                </div>
                                                                <div class="shrink">
                                                                    <button
                                                                    	jsf:id="deleteFilter"
                                                                        jsf:action="#{group.deleteFilter(status.index)}"
                                                                        class="fa fa-trash pull-right">
                                                                        <f:ajax
                                                                            execute=":normdataForm:processes_search"
                                                                            render=":normdataForm:processes_search" />
                                                                    </button>
                                                                </div>

                                                                <div class="clearfix"></div>
                                                            </div>
                                                        </ui:repeat>
                                                        <div class="row">
                                                            <div class="controls-row">
                                                                <h:panelGroup
                                                                    styleClass="group-conjunction"
                                                                    rendered="#{group.numFilters gt 1}">
                                                                    <div
                                                                        class="col-sm-8"
                                                                        style="padding-top: 4px;">
                                                                        <strong>
                                                                            <h:outputText value="#{msgs.NORM_filterconjunction}:" />
                                                                        </strong>
                                                                        <h:selectOneRadio value="#{group.conjunctive}">
                                                                            <f:selectItem
                                                                                itemValue="true"
                                                                                itemLabel="#{msgs.NORM_conjunctive}" />
                                                                            <f:selectItem
                                                                                itemValue="false"
                                                                                itemLabel="#{msgs.NORM_disjunctive}" />
                                                                            <f:ajax />
                                                                        </h:selectOneRadio>
                                                                    </div>
                                                                </h:panelGroup>
                                                                <div class="#{group.numFilters gt 1 ? 'col-sm-4' : 'col-sm-12'}">
                                                                    <div class="new-filter-btn">
                                                                        <button jsf:action="#{group.newFilter}" jsf:id="newFilter" class="button-no-style">
                                                                            <f:ajax
                                                                                execute=":normdataForm:processes_search"
                                                                                render=":normdataForm:processes_search" />
								                               			#{msgs.NORM_newFilter}
								                               		</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </ui:repeat>
                                        <div class="row">
                                            <div class="controls-row">
                                                <h:panelGroup
                                                    styleClass="group-conjunction"
                                                    rendered="#{Metadaten.currentMetadataToPerformSearch.searchRequest.numGroups gt 1}">
                                                    <div
                                                        class="col-sm-8"
                                                        style="padding-top: 4px;">
                                                        <strong>
                                                            <h:outputText value="#{msgs.NORM_groupconjunction}:" />
                                                        </strong>
                                                        <h:selectOneRadio value="#{Metadaten.currentMetadataToPerformSearch.searchRequest.metadataConjunctive}">
                                                            <f:selectItem
                                                                itemValue="true"
                                                                itemLabel="#{msgs.NORM_conjunctive}" />
                                                            <f:selectItem
                                                                itemValue="false"
                                                                itemLabel="#{msgs.NORM_disjunctive}" />
                                                            <f:ajax />
                                                        </h:selectOneRadio>
                                                    </div>
                                                </h:panelGroup>
                                                <div class="#{Metadaten.currentMetadataToPerformSearch.searchRequest.numGroups gt 1 ? 'col-sm-4' : 'col-sm-12'}">
                                                    <div class="new-filter-btn">
                                                        <button jsf:action="#{Metadaten.currentMetadataToPerformSearch.searchRequest.newGroup}" jsf:id="newGroup" class="button-no-style">
                                                            <f:ajax
                                                                execute=":normdataForm:processes_search"
                                                                render=":normdataForm:processes_search" />
				                               			#{msgs.NORM_newGroup}
				                               		</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </c:if>
                                </div>



                                <button
                                    class="btn btn-grey pull-right margin-right-10 margin-top-10 margin-bottom-10"
                                    jsf:action="#{Metadaten.currentMetadataToPerformSearch.search}"
                                    jsf:id="search"
                                    title="#{msgs.search}">
                                    <span class="fa fa-search margin-right-5" />
                                    <h:outputText value="#{msgs.search}" />
                                    <f:ajax
                                        execute="@form"
                                        render="processResults" />
                                </button>

                                <script>
	                                $('input[id*="geonamesSearch"]' ).on('focus',function() {
	                                    $(this ).on('keyup',function(event ) {
	                                        event.preventDefault();
	                                        if ( event.keyCode == 13 ) {
	                                            $(this ).parent().next().click();
	                                        }
	                                    } );
	                                } );
	                            </script>

                            </h:panelGroup>

                            <h:panelGroup
                                id="processResults"
                                rendered="#{Metadaten.currentMetadataToPerformSearch.title == 'ProcessPlugin'}">
                                <h:panelGroup
                                    id="processesList"
                                    layout="block"
                                    styleClass="row pre-scrollable"
                                    rendered="#{not empty Metadaten.currentMetadataToPerformSearch.results}">
                                    <h:message
                                        for="processesList"
                                        showDetail="true"
                                        styleClass="help-inline font-danger" />

                                    <div class="col-sm-12">
                                        <h:dataTable
                                            value="#{Metadaten.currentMetadataToPerformSearch.results}"
                                            var="process"
                                            styleClass="table table-hover table-nomargin dataTable table-bordered responsive">
                                            <c:if test="#{Metadaten.currentMetadataToPerformSearch.title == 'ProcessPlugin'}">
                                                <c:forEach
                                                    items="#{Metadaten.currentMetadataToPerformSearch.searchRequest.wantedFields}"
                                                    var="val">
                                                    <h:column>
                                                        <f:facet name="header">
                                                            <!-- TODO: translation ? -->
                                                            <h:outputText value="#{val}" />
                                                        </f:facet>
                                                        <h:outputText value="#{process.metadata[val][0].value}" />
                                                    </h:column>
                                                </c:forEach>
                                            </c:if>
                                            <h:column>
                                                <f:facet name="header">
                                                    <h:outputText value="#{msgs.action}" />
                                                </f:facet>
                                                <button
                                                    class="btn btn-primary fa fa-check"
                                                    jsf:action="#{Metadaten.currentMetadataToPerformSearch.linkProcess(process)}">
                                                </button>
                                            </h:column>
                                        </h:dataTable>

                                        <h:outputText
                                            value="#{msgs.NORM_noHits}"
                                            rendered="#{Metadaten.currentMetadataToPerformSearch != NULL and Metadaten.currentMetadataToPerformSearch.showNoHitFound}"
                                            style="margin: 20px;" />
                                    </div>

                                </h:panelGroup>
                            </h:panelGroup>
                        </div>
                    </h:panelGroup>
                </div>
            </div>

            <!-- geonames modal -->
            <div
                class="modal fade"
                id="geonamesSearchBox"
                tabindex="-1"
                role="dialog"
                aria-labelledby="myModalLabel">
                <div
                    class="modal-dialog"
                    role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <a
                                href="#"
                                class="btn btn-blue pull-right"
                                title="#{msgs.cancel}"
                                data-dismiss="modal">
                                <span class="fa fa-times" />
                            </a>

                            <h4
                                class="modal-title"
                                id="myModalLabel">
                                <h:outputText value="#{msgs.NORM_geonamesSearch}" />
                            </h4>
                        </div>
                        <div class="modal-body">

                            <h:outputText
                                value="#{msgs.NORM_helpGeonamesSearch}"
                                escape="false" />

                            <br />

                            <div
                                class="row"
                                style="margin-top: 15px;">


                                <div class="col-sm-12">
                                    <h:inputText
                                        value="#{Metadaten.geonamesSearchValue}"
                                        styleClass="form-control input"
                                        id="geonamesSearch" />

                                    <h:message
                                        for="geonamesSearch"
                                        showDetail="true"
                                        styleClass="help-inline font-danger" />
                                </div>


                                <button
                                	jsf:id="geoNameSearch"
                                    class="btn btn-grey pull-right margin-right-10 margin-top-10 margin-bottom-10"
                                    jsf:action="#{Metadaten.search}"
                                    title="#{msgs.search}">
                                    <span class="fa fa-search margin-right-5" />
                                    <h:outputText value="#{msgs.search}" />
                                    <f:ajax
                                        execute="@form"
                                        render="geonamesList" />
                                </button>

                                <script>
                                    $('input[id*="geonamesSearch"]' ).on('focus',function() {
                                        $(this ).on('keyup',function(event ) {
                                            event.preventDefault();
                                            if ( event.keyCode == 13 ) {
                                                $(this ).parent().next().click();
                                            }
                                        } );
                                    } );
                                </script>
                            </div>


                            <h:panelGroup
                                id="geonamesList"
                                layout="block"
                                styleClass="row pre-scrollable">
                                <h:message
                                    for="geonamesList"
                                    showDetail="true"
                                    styleClass="help-inline font-danger" />

                                <ui:repeat
                                    value="#{Metadaten.currentMetadataToPerformSearch.resultList}"
                                    var="geonames">
                                    <hr />
                                    <div
                                        class="row"
                                        style="margin: 20px;">


                                        <div class="col-sm-11">

                                            <div class="row">

                                                <h:panelGroup
                                                    layout="block"
                                                    styleClass="col-sm-4"
                                                    rendered="#{geonames.geoNameId !=''}">
                                                    <h:outputText value="#{msgs.geoNameId}" />
                                                </h:panelGroup>

                                                <h:panelGroup
                                                    layout="block"
                                                    styleClass="col-sm-8"
                                                    rendered="#{geonames.geoNameId !=''}">
                                                    <h:outputText value="#{geonames.geoNameId}" />
                                                </h:panelGroup>

                                                <h:panelGroup
                                                    layout="block"
                                                    styleClass="col-sm-4"
                                                    rendered="#{geonames.name !=''}">
                                                    <h:outputText value="#{msgs.name}" />
                                                </h:panelGroup>

                                                <h:panelGroup
                                                    layout="block"
                                                    styleClass="col-sm-8"
                                                    rendered="#{geonames.name !=''}">
                                                    <h:outputText value="#{geonames.name}" />
                                                </h:panelGroup>

                                                <h:panelGroup
                                                    layout="block"
                                                    styleClass="col-sm-4"
                                                    rendered="#{geonames.alternateNames !=''}">
                                                    <h:outputText value="#{msgs.alternateNames}" />
                                                </h:panelGroup>

                                                <h:panelGroup
                                                    layout="block"
                                                    styleClass="col-sm-8"
                                                    rendered="#{geonames.alternateNames !=''}">
                                                    <h:outputText value="#{geonames.alternateNames}" />
                                                </h:panelGroup>

                                                <h:panelGroup
                                                    layout="block"
                                                    styleClass="col-sm-4"
                                                    rendered="#{geonames.countryName !=''}">
                                                    <h:outputText value="#{msgs.countryName}" />
                                                </h:panelGroup>

                                                <h:panelGroup
                                                    layout="block"
                                                    styleClass="col-sm-8"
                                                    rendered="#{geonames.countryName !=''}">
                                                    <h:outputText value="#{msgs[geonames.countryName]}" />
                                                </h:panelGroup>

                                                <h:panelGroup
                                                    layout="block"
                                                    styleClass="col-sm-4"
                                                    rendered="#{geonames.latitude !=''}">
                                                    <h:outputText value="#{msgs.latitude}" />
                                                </h:panelGroup>

                                                <h:panelGroup
                                                    layout="block"
                                                    styleClass="col-sm-8"
                                                    rendered="#{geonames.latitude !=''}">
                                                    <h:outputText value="#{geonames.latitude}" />
                                                </h:panelGroup>
                                                <h:panelGroup
                                                    layout="block"
                                                    styleClass="col-sm-4"
                                                    rendered="#{geonames.longitude !=''}">
                                                    <h:outputText value="#{msgs.longitude}" />
                                                </h:panelGroup>

                                                <h:panelGroup
                                                    layout="block"
                                                    styleClass="col-sm-8"
                                                    rendered="#{geonames.longitude !=''}">
                                                    <h:outputText value="#{geonames.longitude}" />
                                                </h:panelGroup>

                                                <h:panelGroup
                                                    layout="block"
                                                    styleClass="col-sm-4"
                                                    rendered="#{geonames.population !=''}">
                                                    <h:outputText value="#{msgs.population}" />
                                                </h:panelGroup>

                                                <h:panelGroup
                                                    layout="block"
                                                    styleClass="col-sm-8"
                                                    rendered="#{geonames.population !=''}">
                                                    <h:outputText value="#{geonames.population}" />
                                                </h:panelGroup>
                                            </div>


                                        </div>
                                        <div class="col-sm-1">
                                            <button
                                            	jsf:id="getData"
                                                jsf:action="#{Metadaten.currentMetadataToPerformSearch.getData}"
                                                class="btn btn-green margin-left-5">
                                                <f:setPropertyActionListener
                                                    value="#{geonames}"
                                                    target="#{Metadaten.currentMetadataToPerformSearch.currentToponym}" />
                                                <f:setPropertyActionListener
                                                    value=""
                                                    target="#{Metadaten.geonamesSearchValue}" />
                                                <span class="fa fa-check" />
                                            </button>
                                        </div>
                                    </div>
                                </ui:repeat>

                                <h:outputText
                                    value="#{msgs.NORM_noHits}"
                                    rendered="#{Metadaten.currentMetadataToPerformSearch != NULL and Metadaten.currentMetadataToPerformSearch.showNoHitFound}"
                                    style="margin: 20px;" />

                            </h:panelGroup>
                        </div>
                    </div>
                </div>
            </div>


            <!-- dante search modal -->
            <div
                class="modal fade"
                id="danteSearchBox"
                tabindex="-1"
                role="dialog"
                aria-labelledby="myModalLabel">
                <div
                    class="modal-dialog"
                    style="width: 700px"
                    role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <a
                                href="#"
                                class="btn btn-blue pull-right"
                                title="#{msgs.cancel}"
                                data-dismiss="modal">
                                <span class="fa fa-times" />
                            </a>

                            <h4
                                class="modal-title"
                                id="myModalLabel">
                                <h:outputText value="#{msgs.NORM_danteSearch}" />
                            </h4>
                        </div>
                        <div class="modal-body">

                            <h:outputText
                                value="#{msgs.NORM_descriptionTextDanteSearch}"
                                escape="false" />

                            <br />

                            <div
                                class="row"
                                style="margin-top: 15px;">


                                <div class="col-sm-8">
                                    <!-- search button? -->
                                    <h:inputText
                                        value="#{Metadaten.danteSearchValue}"
                                        styleClass="form-control input"
                                        id="danteInput" />
                                </div>
                                <div class="col-sm-4">
                                    <button
                                        class="btn btn-grey pull-right margin-right-10 "
                                        jsf:action="#{Metadaten.search}"
                                        jsf:id="search2"
                                        title="#{msgs.search}">
                                        <span class="fa fa-search margin-right-5" />
                                        <h:outputText value="#{msgs.search}" />
                                        <f:ajax
                                            execute="@form"
                                            render="resultList" />
                                    </button>
                                </div>
                                <script>
                                $('input[id*="danteInput"]' ).on('focus',function() {
                                    $(this ).on('keyup',function(event ) {
                                        event.preventDefault();
                                        if ( event.keyCode == 13 ) {
                                            $(this ).parent().next().click();
                                        }
                                    } );
                                } );
                                </script>
                            </div>

                            <h:panelGroup
                                layout="block"
                                id="resultList"
                                class="row pre-scrollable"
                                style="max-height:550px;">
                                <ui:repeat
                                    value="#{Metadaten.currentMetadataToPerformSearch.normdataList}"
                                    var="normdataRecord">
                                    <hr />
                                    <div
                                        class="row"
                                        style="margin: 20px;">

                                        <div class="col-sm-11">
                                            <div class="row">
                                                <div class="col-sm-4">
                                                    <h:outputText value="#{msgs.NORM_dantePreferredValue}" />
                                                </div>
                                                <div class="col-sm-8">
                                                    <h:selectOneMenu
                                                        value="#{normdataRecord.preferredValue}"
                                                        styleClass="form-control">
                                                        <f:selectItems value="#{normdataRecord.valueList}" />

                                                    </h:selectOneMenu>
                                                </div>
                                            </div>
                                            <ui:repeat
                                                value="#{normdataRecord.normdataList}"
                                                var="normdata">

                                                <h:panelGroup
                                                    layout="block"
                                                    styleClass="row"
                                                    rendered="#{normdata.key.contains('NORM_LABEL') or normdata.key.contains('NORM_ALTLABEL') or normdata.key.contains('NORM_NOTATION') or normdata.key.contains('URI')}">
                                                    <div class="col-sm-4">
                                                        <h:outputText value="#{msgs[normdata.key]}" />
                                                    </div>

                                                    <div class="col-sm-8">
                                                        <ui:repeat
                                                            value="#{normdata.values}"
                                                            var="value">
                                                            <div class="row">
                                                                <div class="col-sm-12">
                                                                    <h:outputLink
                                                                        rendered="#{value.url != null}"
                                                                        target="_blank"
                                                                        value="#{value.url}">
                                                                        <h:outputText value="#{value.text}" />
                                                                        <h:outputText
                                                                            rendered="#{value.identifier != null}"
                                                                            value=" (#{value.identifier})" />
                                                                    </h:outputLink>

                                                                    <h:outputText
                                                                        value="#{value.text}"
                                                                        rendered="#{value.url == null}" />
                                                                </div>
                                                            </div>
                                                        </ui:repeat>
                                                    </div>
                                                </h:panelGroup>
                                            </ui:repeat>


                                        </div>
                                        <h:panelGroup
                                            layout="block"
                                            class="col-sm-1">
                                            <button
                                            	jsf:id="gndSearchGetData"
                                                class="btn btn-green margin-left-5"
                                                jsf:action="#{Metadaten.currentMetadataToPerformSearch.getData}">
                                                <f:setPropertyActionListener
                                                    value="#{normdataRecord}"
                                                    target="#{Metadaten.currentMetadataToPerformSearch.selectedRecord}" />
                                                <f:setPropertyActionListener
                                                    value=""
                                                    target="#{Metadaten.searchOption}" />
                                                <f:setPropertyActionListener
                                                    value=""
                                                    target="#{Metadaten.gndSearchValue}" />
                                                <span class="fa fa-check" />
                                            </button>
                                        </h:panelGroup>
                                    </div>
                                </ui:repeat>
                                <h:outputText
                                    value="#{msgs.NORM_noHits}"
                                    rendered="#{Metadaten.currentMetadataToPerformSearch != NULL and Metadaten.currentMetadataToPerformSearch.showNoHitFound}"
                                    style="margin: 20px;" />

                            </h:panelGroup>
                        </div>
                    </div>
                </div>
            </div>

            <script type="text/javascript">

            	 $( 'body' ).on( 'click', 'a[id*="geonamesIndexTrigger-"]', function() {
	                  var currIndex = $( this ).attr( 'data-row' );
	                  var currType = $( this ).attr( 'data-datatype' );
	                  $( '#rowIndex' ).val( currIndex );
	                  $( '#rowType' ).val( currType );
	              } );

	              $( 'body' ).on( 'click', 'a[id*="gndIndexTrigger-"]', function() {
	                  var currIndex = $( this ).attr( 'data-row' );
	                  var currType = $( this ).attr( 'data-datatype' );
	                  $( '#rowIndex' ).val( currIndex );
	                  $( '#rowType' ).val( currType );
	              } );

	              $( 'body' ).on( 'click', 'a[id*="gndPersonIndexTrigger-"]', function() {
	                  var currIndex = $( this ).attr( 'data-row' );
	                  var currType = $( this ).attr( 'data-datatype' );
	                  $( '#rowIndex' ).val( currIndex );
	                  $( '#rowType' ).val( currType );
	              } );

	              $( 'body' ).on( 'click', 'a[id*="danteIndexTrigger-"]', function() {
	                  var currIndex = $( this ).attr( 'data-row' );
	                  var currType = $( this ).attr( 'data-datatype' );
	                  var currGroup = $( this ).attr( 'data-groupindex')
	                  $( '#rowIndex' ).val( currIndex );
	                  $( '#groupIndex' ).val( currGroup );
	                  $( '#rowType' ).val( currType );

	                  $('#resultList').empty();
	                  $('#danteInput').val('');
	                  $('#updatePluginButton').click();
	              } );

	              $( 'body' ).on( 'click', 'a[id*="processIndexTrigger-"]', function() {
	                  var currIndex = $( this ).attr( 'data-row' );
	                  var currType = $( this ).attr( 'data-datatype' );
	                  var currGroup = $( this ).attr( 'data-groupindex')
	                  $( '#rowIndex' ).val( currIndex );
	                  $( '#groupIndex' ).val( currGroup );
	                  $( '#rowType' ).val( currType );
	                  $('#updatePluginButton').click();
	              } );
          </script>
        </h:form>
        </main>
    </ui:define>

</ui:composition>