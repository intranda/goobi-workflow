<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:c="http://java.sun.com/jsp/jstl/core"
        template="/uii/templatePG/templatePG.html"
        xmlns:composite="http://xmlns.jcp.org/jsf/composite"
        xmlns:intranda="http://xmlns.jcp.org/jsf/composite/compositesPG"
        xmlns:jsf="http://xmlns.jcp.org/jsf"
        xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:x="http://myfaces.apache.org/tomahawk"
>
    <composite:interface>
        <composite:attribute
                name="vocabulary"
                type="io.goobi.workflow.api.vocabulary.helper.ExtendedVocabulary"
                required="true"
        />
    </composite:interface>

    <composite:implementation>
        <intranda:box
            boxForm="false"
            boxPadding="true"
            boxType="neutral"
            boxTitle="false">
            <intranda:boxTitle
                    title="#{cc.attrs.vocabulary.name}"
                    icon="fa-database">
                <div class="actions d-flex">
                    <!-- import -->
                    <button
                            jsf:id="uploadRecords"
                            class="btn d-flex align-items-center btn&#45;&#45;title-action"
                            jsf:rel="tooltip"
                            jsf:action="#{vocabularyRecordsBean.uploadRecords}"
                            title="#{msgs.vocabularyManager_uploadRecords}">
                        <span class="fa fa-upload me-1"/>
                        <f:passThroughAttribute
                                name="data-toggle"
                                value="tooltip"/>
                        <f:passThroughAttribute
                                name="aria-label"
                                value="#{msgs.vocabularyManager_uploadRecords}"/>
                    </button>
                    <!-- export -->
                    <h:outputLink
                            styleClass="btn d-flex align-items-center btn&#45;&#45;title-action"
                            value="#{cc.attrs.vocabulary.jsonExport()}"
                            title="#{msgs.vocabularyManager_downloadRecordsAsJson}"
                    >
                        <span aria-hidden="true" class="fa fa-download me-1"/>
                        JSON
                    </h:outputLink>
                    <h:outputLink
                            styleClass="btn d-flex align-items-center btn&#45;&#45;title-action"
                            value="#{cc.attrs.vocabulary.excelExport()}"
                            title="#{msgs.vocabularyManager_downloadRecordsAsExcel}"
                    >
                        <span aria-hidden="true" class="fa fa-download me-1"/>
                        Excel
                    </h:outputLink>
                    <h:outputLink
                            styleClass="btn d-flex align-items-center btn&#45;&#45;title-action"
                            value="#{cc.attrs.vocabulary.csvExport()}"
                            title="#{msgs.vocabularyManager_downloadRecordsAsCsv}"
                    >
                        <span aria-hidden="true" class="fa fa-download me-1"/>
                        CSV
                    </h:outputLink>
                    <ui:fragment
                            rendered="#{cc.attrs.vocabulary.skosExportPossible}">
                        <h:outputLink
                                styleClass="btn d-flex align-items-center btn&#45;&#45;title-action"
                                value="#{cc.attrs.vocabulary.rdfXmlExport()}"
                                title="#{msgs.vocabularyManager_downloadRecordsAsRdfXml}"
                        >
                            <span aria-hidden="true" class="fa fa-download me-1"/>
                            RDF/XML
                        </h:outputLink>
                        <h:outputLink
                                styleClass="btn d-flex align-items-center btn&#45;&#45;title-action"
                                value="#{cc.attrs.vocabulary.rdfTurtleExport()}"
                                title="#{msgs.vocabularyManager_downloadRecordsAsRdfTurtle}"
                        >
                            <span aria-hidden="true" class="fa fa-download me-1"/>
                            RDF/Turtle
                        </h:outputLink>
                    </ui:fragment>
                </div>
                <!-- /actions -->
            </intranda:boxTitle>

            <!-- table of records -->
            <h:panelGroup layout="block" id="recordList" styleClass="box__body">
                <div class="gw-table">
                    <div class="gw-table gw-table__search">

                        <div class="gw-table__search__length">
                            <!-- TODO: Calculate the filtered result size -->
                            <h:outputText
                                    value="#{msgs.treffer}: #{vocabularyRecordsBean.paginator.totalResults}"
                            />
                            <!--                        <h:outputText-->
                            <!--                                rendered="#{vocabularyRecordsBean.paginator.searchParameter != null or vocabularyRecordsBean.paginator.searchParameter ne ''}"-->
                            <!--                                value=" #{msgs.von} #{vocabularyBean.paginator.totalResults}"/>-->
                        </div>

                        <div class="gw-table__filters">
                            <!-- Search box -->
                            <div class="gw-table__filters__search-bar">
                                <div class="input-group input-group">
                                    <span class="input-group-text">
                                        <span class="fa fa-search"/>
                                    </span>
                                    <h:inputText
                                            id="searchField"
                                            pt:aria-label="search"
                                            styleClass="form-control searchfield"
                                            value="#{vocabularyRecordsBean.paginator.searchParameter}">
                                        <f:passThroughAttribute
                                                name="placeholder"
                                                value="#{msgs.search}"/>
                                    </h:inputText>
                                    <button
                                            type="button"
                                            jsf:id="FilterAlle2"
                                            jsf:forceId="true"
                                            class="btn btn-blank"
                                            jsf:action="#{vocabularyRecordsBean.reload()}">
                                        <f:ajax render="@form" execute="@form"></f:ajax>
                                        #{msgs.search}
                                    </button>
                                </div>
                                <x:commandButton
                                        type="submit"
                                        id="FilterAlle"
                                        forceId="true"
                                        style="display: none;"
                                        action="#{vocabularyRecordsBean.reload()}">
                                    <f:ajax render="@form" execute="@form"></f:ajax>
                                </x:commandButton>
                            </div> <!-- /__search-bar -->
                        </div> <!-- /__filters -->
                    </div> <!-- /__search -->

                    <div class="gw-table">
                        <div class="gw-table__wrapper">

                            <table class="table table-hover table-bordered" role="grid">

                                <thead>
                                <tr role="row">
                                    <ui:repeat var="definition" value="#{vocabularyRecordsBean.titleFields}">
                                        <th scope="col" role="columnheader">
                                            <button
                                                    jsf:id="changeOrderLabel"
                                                    class="button-link"
                                                    style="width: 100%; text-align: left;"
                                                    jsf:action="#{vocabularyRecordsBean.reload()}">
                                                <h:outputText
                                                        value="#{definition.name}"/>
                                                <!--                                            value="#{definition.name} #{definition.language != '' ? msgs[definition.language] : ''}"/>-->

                                                <span class="pull-right table-sort-icon fa #{vocabularyRecordsBean.paginator.sortField==definition.id.toString().concat(',ASC')?'fa-sort-asc':vocabularyRecordsBean.paginator.sortField==definition.id.toString().concat(',DESC')?'fa-sort-desc':'fa-sort'}"/>
                                                <f:setPropertyActionListener
                                                        target="#{vocabularyRecordsBean.paginator.sortField}"
                                                        value="#{vocabularyRecordsBean.paginator.sortField==definition.id.toString().concat(',ASC')?definition.id.toString().concat(',DESC'):definition.id.toString().concat(',ASC')}"/>
                                                <f:ajax render="@form"/>
                                            </button>
                                        </th>

                                    </ui:repeat>
                                    <th class="gw-table-fixed__actions">
                                        <h:outputText value="#{msgs.auswahl}"/>
                                    </th>

                                </tr>
                                </thead>

                                <tbody>
                                <c:forEach varStatus="status" var="record" items="#{vocabularyRecordsBean.paginator.items}">
                                    <intranda:vocabularyRecordListEntry record="#{record}"/>
                                </c:forEach>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- navigation buttons to flip through all records -->
                    <div class="box__actions">

                        <!-- add new record -->
                        <ui:fragment rendered="#{vocabularyRecordsBean.isRootRecordCreationPossible() == true}">
                            <button jsf:id="new_record" jsf:action="#{vocabularyRecordsBean.createEmpty(null)}"
                                    class="btn btn-primary me-auto"
                                    title="#{msgs.vocabularyManager_addRecord}">
                                <span aria-hidden="true" class="fa fa-plus"/>
                                <span>
                                    <h:outputText value="#{msgs.vocabularyManager_addRecord}"/>
                                </span>
                            </button>
                        </ui:fragment>

                        <!-- Cancel (go back to vocab overview)-->
                        <button
                                class="btn btn-blank"
                                jsf:id="abbrechen"
                                jsf:type="cancel"
                                jsf:action="vocabulary_overview"
                                jsf:immediate="true">
                            <h:outputText value="#{msgs.vocabularyManager_backToVocabularies}"/>
                        </button>

                        <intranda:paginator id="record" paginator="#{vocabularyRecordsBean.paginator}"/>
                    </div> <!-- /box__actions -->
                </div>
            </h:panelGroup>
        </intranda:box>
    </composite:implementation>
</ui:composition>
